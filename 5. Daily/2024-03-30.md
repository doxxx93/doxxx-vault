요구사항을 체크리스트로 정리해보겠습니다.

## 결제시스템 요구사항 체크리스트

### 1. 저장하는 string 데이터

- [ ] 공통 헤더부문과 데이터부문을 합쳐서 하나의 string(450자리)으로 만들어 저장
- [ ] 데이터 타입과 길이에 따라 정의된 형식에 맞춰 저장

### 2. 부가가치세

- [ ] 결제금액에 따라 자동계산되어 부가가치세를 생성
- [ ] 부가가치세는 결제금액보다 클 수 없음

### 3. 카드정보 암/복호화

- [x] 카드번호, 유효기간, cvc 데이터를 암호화하여 저장
- [x] 암호화된 데이터를 복호화할 수 있도록 객체화
- [x] 카드정보 암/복호화 방식 선택 및 구현

### 4. 트랜잭션 데이터 관리

- [ ] 각 결제, 결제취소 데이터는 관리번호로 구분하여 관리
- [ ] 취소데이터는 결제데이터와 연결
- [x] 관리번호로 데이터 조회 및 관리

### 5. 필수 구현 API

#### 결제 API

- [x] 카드정보와 금액정보 입력받아 DB에 저장
- [x] 관리번호와 카드사에 전달된 string 데이터 반환

#### 결제취소 API

- [ ] 결제에 대한 전체취소 기능 구현
- [ ] 관리번호와 취소금액 입력받아 DB에 저장 및 카드사에 전달된 string 데이터 반환

#### 데이터 조회 API

- [x] 관리번호 입력받아 DB에서 데이터 조회
- [x] 카드정보 암호화된 데이터 복호화하여 반환

#### API 요청 실패시

- [ ] 에러응답 및 에러코드 정의

### 6. 선택 문제

#### 부분취소 API 구현

- [ ] 부분취소 기능 구현
- [ ] 부분취소에 대한 Test Case 작성 및 테스트

#### Multi Thread 환경 대비

- [ ] 결제, 취소, 부분취소 과정에서 Multi Thread 환경에 대비한 방어 코드 추가
- [ ] Multi Thread 환경에서의 안정성을 확인하기 위한 Test 코드 작성


- totalAmount number  
    
    총 결제 금액입니다. 결제가 취소되는 등 결제 상태가 변해도 최초에 결제된 결제 금액으로 유지됩니다.
    
- balanceAmount number  
    
    취소할 수 있는 금액(잔고)입니다. 이 값은 결제 취소나 부분 취소가 되고 나서 남은 값입니다. 결제 상태 변화에 따라 `vat`, `suppliedAmount`, `taxFreeAmount`, `taxExemptionAmount`와 함께 값이 변합니다.

- lastTransactionKey nullable · string  
    
    마지막 거래의 키 값입니다. 한 결제 건의 승인 거래와 취소 거래를 구분하는 데 사용됩니다. 예를 들어 결제 승인 후 부분 취소를 두 번 했다면 마지막 부분 취소 거래의 키 값이 할당됩니다. 최대 길이는 64자입니다.