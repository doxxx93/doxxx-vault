---
date_created: 2024-06-04 12:36
author: 
date_published: 
url:
---
# 전자 지갑

- 서론
    - 전자 지갑 개발에서 중요한 `POST balance_transfer` API 소개
    - 분산 트랜잭션 처리의 필요성과 과제
- 인메모리 샤딩(레디스)
    - 인메모리 샤딩의 개념과 장단점
    - 레디스를 활용한 인메모리 샤딩 구현
- 분산 트랜잭션
    - 데이터베이스 샤딩
    - 2단계 커밋(2PC)
    - TC/C (Try-Confirm/Cancel)
    - 2PC와 TC/C 비교
    - 불균형 상태 및 유효한 연산 순서
    - 발생 가능한 문제 상황 시나리오
- 사가 패턴
    - 사가 패턴 소개
    - 코레오그래피와 오케스트레이션
    - TC/C와 사가 패턴 비교
- 이벤트 소싱
    - 이벤트 소싱 개념 소개
    - 명령, 이벤트, 상태, 상태 기계
    - 재현성과 이벤트 소싱
    - 명령-질의 책임 분리(CQRS)를 통한 계정 잔액 조회
- 고성능 이벤트 소싱 아키텍처
    - 카프카를 이용한 명령과 이벤트 저장소
    - 데이터베이스를 이용한 상태 저장소
    - 최적화 방안: 파일 기반 상태, 스냅숏
- 분산 이벤트 소싱
    - 고신뢰성 솔루션을 위한 분산 이벤트 소싱
    - 풀 모델과 푸시 모델
    - 역방향 프록시 고려사항
- 분산 트랜잭션 모델 통합
    - 이벤트 소싱과 분산 트랜잭션 모델 결합
    - 전자 지갑 개발에서의 적용 방안
- 결론
    - 전자 지갑 개발에서 분산 트랜잭션 처리의 중요성
    - 인메모리 샤딩부터 이벤트 소싱까지의 발전 과정
    - 향후 전망과 과제

# 책

## 1단계

-  기능 요구사항
	- 계정 간 자금 이체
-  비기능 요구사항
	- 1,000,000 TPS
		- 트랜잭션 기반 데이터베이스를 사용
	- 99.99% 신뢰성
	- 트랜잭션 지원
	- 재현성 지원
		- 이벤트 소싱(event sourcing) 솔루션

## 2단계

- API 설계
	- Wallet/balance_transfer
- 메모리 기반 샤딩 방안
- 테이터베이스 샤딩
	- 범위 기반 샤딩
	- 해시 샤딩
	- 디렉터리 샤딩
	- 지리적 샤딩

[데이터베이스 샤딩의 대안](데이터베이스%20샤딩의%20대안.md)

- 2PC(2 Phase Commit)
- TC/C(Try-Confirm/Cancel)
- 실행 순서가 잘못된 경우의 처리
- 이벤트 소싱

## 3단계

- 고성능 이벤트 소싱
- 고신뢰성 이벤트 소싱
- 분산 이벤트 소싱
	- 풀 vs 푸시
	- 분산 트랜잭션

## 4단계

- 마무리
